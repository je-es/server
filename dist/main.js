import {Database}from'bun:sqlite';import ce from'crypto';var L=class{constructor(e=":memory:"){this.schemas=new Map;this.currentQuery="";this.currentParams=[];this.db=new Database(e),this.db.exec("PRAGMA foreign_keys = ON");}close(){this.db.close();}defineSchema(e){this.schemas.set(e.name,e);let r=this.generateCreateTableSQL(e);if(this.db.exec(r),e.indexes)for(let t of e.indexes){let o=`CREATE ${t.unique?"UNIQUE":""} INDEX IF NOT EXISTS ${t.name} ON ${e.name} (${t.columns.join(", ")})`;this.db.exec(o);}}getSchema(e){return this.schemas.get(e)}listTables(){return this.db.query("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'").all().map(r=>r.name)}dropTable(e){this.db.exec(`DROP TABLE IF EXISTS ${e}`),this.schemas.delete(e);}query(){return this.reset(),this.createQueryBuilder()}find(e,r){let t=Object.entries(r).map(([n,o])=>({column:n,operator:"=",value:o}));return this.query().select().from(e).where(t).execute()}findOne(e,r){return this.query().select().from(e).where(Object.entries(r).map(([t,n])=>({column:t,operator:"=",value:n}))).limit(1).executeOne()}findById(e,r){return this.findOne(e,{id:r})}all(e){return this.query().select().from(e).execute()}insert(e,r){this.query().insert(e,r).execute();let t=this.db.query("SELECT last_insert_rowid() as id").get();return this.findById(e,t.id)}update(e,r,t){return this.query().update(e,t).where({column:"id",operator:"=",value:r}).execute(),this.findById(e,r)}delete(e,r){this.query().delete(e).where({column:"id",operator:"=",value:r}).execute();return  true}transaction(e){this.db.exec("BEGIN TRANSACTION");try{e(this),this.db.exec("COMMIT");}catch(r){throw this.db.exec("ROLLBACK"),r}}exec(e){this.db.exec(e);}raw(e,r=[]){return this.db.query(e).all(...r)}rawOne(e,r=[]){return this.db.query(e).get(...r)}reset(){this.currentQuery="",this.currentParams=[];}createQueryBuilder(){let e={_select:["*"],_from:"",_where:[],_orderBy:"",_limit:null,_offset:null,_isInsert:false,_isUpdate:false,_isDelete:false,_insertData:null,_updateData:null},r=this;return e.select=function(t){return this._select=t||["*"],this},e.from=function(t){return this._from=t,this},e.where=function(t){let o=(Array.isArray(t)?t:[t]).map(u=>{if(u.operator==="IS NULL"||u.operator==="IS NOT NULL")return `${u.column} ${u.operator}`;if(u.operator==="IN"&&Array.isArray(u.value)){let a=u.value.map(()=>"?").join(", ");return u.value.forEach(d=>{r.currentParams.push(d);}),`${u.column} IN (${a})`}else return r.currentParams.push(u.value),`${u.column} ${u.operator} ?`});return this._where.push(...o),this},e.and=function(t){return this.where(t)},e.or=function(t){if(t.operator==="IS NULL"||t.operator==="IS NOT NULL")this._where.push(`OR ${t.column} ${t.operator}`);else if(t.operator==="IN"&&Array.isArray(t.value)){let n=t.value.map(()=>"?").join(", ");t.value.forEach(o=>{r.currentParams.push(o);}),this._where.push(`OR ${t.column} IN (${n})`);}else r.currentParams.push(t.value),this._where.push(`OR ${t.column} ${t.operator} ?`);return this},e.orderBy=function(t,n="ASC"){return this._orderBy=`ORDER BY ${t} ${n}`,this},e.limit=function(t){return this._limit=t,this},e.offset=function(t){return this._offset=t,this},e.insert=function(t,n){return this._isInsert=true,this._from=t,this._insertData=n,this},e.update=function(t,n){return this._isUpdate=true,this._from=t,this._updateData=n,this},e.delete=function(t){return this._isDelete=true,this._from=t,this},e.raw=function(t,n=[]){return r.currentQuery=t,r.currentParams=n,this},e.execute=function(){let t="";if(this._isInsert&&this._insertData){let u=Object.keys(this._insertData),a=u.map(()=>"?").join(", ");t=`INSERT INTO ${this._from} (${u.join(", ")}) VALUES (${a})`,r.currentParams=Object.values(this._insertData);}else if(this._isUpdate&&this._updateData){let u=Object.keys(this._updateData).map(d=>`${d} = ?`),a=Object.values(this._updateData);r.currentParams=[...a,...r.currentParams],t=`UPDATE ${this._from} SET ${u.join(", ")}`,this._where.length>0&&(t+=` WHERE ${this._where.join(" AND ")}`);}else this._isDelete?(t=`DELETE FROM ${this._from}`,this._where.length>0&&(t+=` WHERE ${this._where.join(" AND ")}`)):(t=`SELECT ${this._select.join(", ")} FROM ${this._from}`,this._where.length>0&&(t+=` WHERE ${this._where.join(" AND ")}`),this._orderBy&&(t+=` ${this._orderBy}`),this._limit!==null&&(t+=` LIMIT ${this._limit}`),this._offset!==null&&(t+=` OFFSET ${this._offset}`));!t&&r.currentQuery&&(t=r.currentQuery);let o=r.db.query(t).all(...r.currentParams);return r.reset(),o},e.executeOne=function(){let t=this.execute();return t.length>0?t[0]:null},e.executeRaw=function(t,n=[]){return r.db.query(t).all(...n)},e}generateCreateTableSQL(e){let r=e.columns.map(t=>{let n=`${t.name} ${t.type}`;return t.primaryKey&&(n+=" PRIMARY KEY",t.autoIncrement&&(n+=" AUTOINCREMENT")),t.notNull&&!t.primaryKey&&(n+=" NOT NULL"),t.unique&&(n+=" UNIQUE"),t.default!==void 0&&(typeof t.default=="string"?n+=` DEFAULT '${t.default}'`:t.default===null?n+=" DEFAULT NULL":n+=` DEFAULT ${t.default}`),t.references&&(n+=` REFERENCES ${t.references.table}(${t.references.column})`),n});return `CREATE TABLE IF NOT EXISTS ${e.name} (${r.join(", ")})`}};function Y(s,e){return {name:s,columns:e}}function Z(s,e){return {name:s,type:e}}function ee(s){return {name:s,type:"INTEGER"}}function te(s){return {name:s,type:"TEXT"}}function re(s){return {name:s,type:"REAL"}}function ne(s){return {name:s,type:"BLOB"}}function se(s){return {name:s,type:"NUMERIC"}}function oe(s,e=false){return {...s,primaryKey:true,autoIncrement:e}}function ie(s){return {...s,notNull:true}}function ae(s){return {...s,unique:true}}function ue(s,e){return {...s,default:e}}function le(s,e,r){return {...s,references:{table:e,column:r}}}var _=class{constructor(){this.routes=new Map;this.regexRoutes=[];}match(e,r){let t=`${e}:${r}`;if(this.routes.has(t))return {handler:this.routes.get(t),params:{}};for(let n of this.regexRoutes)if(n.method===e){let o=r.match(n.pattern);if(o?.groups)return {handler:n.handler,params:o.groups}}return null}getAll(){let e=Array.from(this.routes.entries()).map(([t,n])=>{let o=t.indexOf(":"),u=t.substring(0,o),a=t.substring(o+1);return {method:u,path:a,handler:n}}),r=this.regexRoutes.map(t=>{let n=t.key.indexOf(":");return {method:t.method,path:t.key.substring(n+1),handler:t.handler}});return [...e,...r]}clear(){this.routes.clear(),this.regexRoutes=[];}remove(e,r){let t=`${e}:${r}`;if(this.routes.has(t))return this.routes.delete(t),true;let n=this.regexRoutes.findIndex(o=>o.key===t);return n>=0?(this.regexRoutes.splice(n,1),true):false}register(e,r,t,n={}){let o=`${e}:${r}`;if(r.includes(":")){let u=this.pathToRegex(r),a=this.regexRoutes.findIndex(m=>m.key===o),d={pattern:u,method:e,handler:t,key:o};a>=0?this.regexRoutes[a]=d:this.regexRoutes.push(d);}else this.routes.set(o,t);}pathToRegex(e){let t=e.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/:(\w+)/g,"(?<$1>[^/]+)");return new RegExp(`^${t}$`)}};var N=class{constructor(){this.rateLimitStore=new Map;this.csrfTokens=new Map;this.requestLog=new Map;this.MAX_REQUEST_LOG_SIZE=1e3;}checkRateLimit(e,r,t){let n=Date.now(),o=this.rateLimitStore.get(e);return o?n<o.reset?o.count>=r?false:(o.count++,true):(this.rateLimitStore.set(e,{count:1,reset:n+t}),true):(this.rateLimitStore.set(e,{count:1,reset:n+t}),true)}cleanupRateLimit(){let e=Date.now();for(let[r,t]of this.rateLimitStore.entries())e>t.reset&&this.rateLimitStore.delete(r);}generateCsrfToken(e,r=36e5){let t=ce.randomBytes(32).toString("hex");return this.csrfTokens.set(t,{sessionId:e,expires:Date.now()+r}),t}validateCsrfToken(e,r){let t=this.csrfTokens.get(e);return t?Date.now()>t.expires?(this.csrfTokens.delete(e),false):t.sessionId===r?(this.csrfTokens.delete(e),true):false:false}cleanupCsrfTokens(){let e=Date.now();for(let[r,t]of this.csrfTokens.entries())e>t.expires&&this.csrfTokens.delete(r);}sanitizeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}sanitizeSql(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"").replace(/'/g,"''").replace(/"/g,'\\"').replace(/\x00/g,""):""}logRequest(e,r,t,n,o,u){if(this.requestLog.set(e,{timestamp:new Date().toISOString(),method:r,path:t,ip:n,status:o,duration:u}),this.requestLog.size>this.MAX_REQUEST_LOG_SIZE){let{value:a}=this.requestLog.keys().next()||{value:null};a&&this.requestLog.delete(a);}}getRequestLog(e){return this.requestLog.get(e)}getAllRequestLogs(){return Array.from(this.requestLog.values())}clearAll(){this.rateLimitStore.clear(),this.csrfTokens.clear(),this.requestLog.clear();}getStats(){return {rateLimitEntries:this.rateLimitStore.size,csrfTokens:this.csrfTokens.size,requestLogs:this.requestLog.size}}};var k=class{constructor(e="info",r=false){this.level=1;this.pretty=false;this.levels={debug:0,info:1,warn:2,error:3,fatal:4};this.colors={reset:"\x1B[0m",gray:"\x1B[90m",cyan:"\x1B[36m",green:"\x1B[32m",yellow:"\x1B[33m",red:"\x1B[31m",magenta:"\x1B[35m",bold:"\x1B[1m"};this.level=this.levels[e]??1,this.pretty=r;}debug(e,r){this.log("debug",this.levels.debug,e,r);}info(e,r){this.log("info",this.levels.info,e,r);}warn(e,r){this.log("warn",this.levels.warn,e,r);}error(e,r){this.log("error",this.levels.error,e,r);}fatal(e,r){this.log("fatal",this.levels.fatal,e,r),process.env.NODE_ENV;}log(e,r,t,n){if(r<this.level)return;let o=t??{};if(this.pretty)this.prettyLog(e,o,n);else {let a={timestamp:new Date().toISOString(),level:e.toUpperCase(),message:n||"No message",...o},d=JSON.stringify(a);e==="error"||e==="fatal"?console.error(d):e==="warn"?console.warn(d):console.log(d);}}prettyLog(e,r,t){let n=this.colors,o=new Date().toLocaleTimeString("en-US",{hour12:false});if(r.method&&r.path&&r.status!==void 0){let p=this.colorizeMethod(r.method),w=this.colorizeStatus(r.status),b=r.duration?`${r.duration}ms`:"",l=r.path;console.log(`${n.gray}${o}${n.reset} ${p} ${n.bold}${l}${n.reset} ${w} ${n.gray}${b}${n.reset}`);return}if(t==="Route added"&&r.method&&r.path){let p=Array.isArray(r.method)?r.method.join("|"):r.method;console.log(`${n.gray}${o}${n.reset} ${n.cyan}\u2192${n.reset} ${n.bold}${p.padEnd(6)}${n.reset} ${r.path}`);return}if(t==="\u2714 Database connected"){console.log(`${n.gray}${o}${n.reset} ${n.green}\u2713${n.reset} Database connected ${n.gray}(${r.name})${n.reset}`);return}if(t==="Server started"){console.log(`${n.gray}${o}${n.reset} ${n.green}\u2713${n.reset} Server started at ${n.cyan}${r.url}${n.reset}`);return}let u=this.getLevelIcon(e),a=this.getLevelColor(e),d=`${n.gray}${o}${n.reset} ${a}${u}${n.reset} `;t&&(d+=`${t} `);let m=Object.keys(r).filter(p=>!["timestamp","level","message"].includes(p));if(m.length>0){let p=m.map(w=>{let b=r[w];return typeof b=="string"||typeof b=="number"?`${n.gray}${w}:${n.reset}${b}`:null}).filter(Boolean);p.length>0&&(d+=n.gray+p.join(" ")+n.reset);}console.log(d);}colorizeMethod(e){let r=this.colors,t=e.toUpperCase();switch(t){case "GET":return `${r.green}${t}${r.reset}`;case "POST":return `${r.cyan}${t}${r.reset}`;case "PUT":return `${r.yellow}${t}${r.reset}`;case "DELETE":return `${r.red}${t}${r.reset}`;case "PATCH":return `${r.magenta}${t}${r.reset}`;default:return `${r.gray}${t}${r.reset}`}}colorizeStatus(e){if(!e)return "";let r=this.colors,t=e.toString();return e>=200&&e<300?`${r.green}${t}${r.reset}`:e>=300&&e<400?`${r.cyan}${t}${r.reset}`:e>=400&&e<500?`${r.yellow}${t}${r.reset}`:e>=500?`${r.red}${t}${r.reset}`:`${r.gray}${t}${r.reset}`}getLevelIcon(e){switch(e){case "debug":return "\u25C6";case "info":return "\u2192";case "warn":return "\u26A0";case "error":return "\u2716";case "fatal":return "\u2620";default:return "\u2022"}}getLevelColor(e){let r=this.colors;switch(e){case "debug":return r.gray;case "info":return r.cyan;case "warn":return r.yellow;case "error":return r.red;case "fatal":return r.red+r.bold;default:return r.reset}}};var E=class extends Error{constructor(r,t=500,n){super(r);this.message=r;this.statusCode=t;this.code=n;this.name="AppError";}},T=class extends E{constructor(r,t){super(r,400,"VALIDATION_ERROR");this.issues=t;this.name="ValidationError";}},W=class extends E{constructor(e){super(e,500,"DATABASE_ERROR"),this.name="DatabaseError";}},P=class extends E{constructor(e="Request timeout"){super(e,408,"TIMEOUT_ERROR"),this.name="TimeoutError";}},G=class extends E{constructor(e="Too many requests"){super(e,429,"RATE_LIMIT_ERROR"),this.name="RateLimitError";}};var B=new N,q=new _;function pe(s={}){let e=Number(s.port)||3e3,r=s.hostname||"localhost",t=s.maxRequestSize||10*1024*1024,n=s.requestTimeout||3e4,o=s.gracefulShutdownTimeout||1e4,u=typeof s.logging=="object"?s.logging:{},a=s.logging?new k(u.level||"info",u.pretty):null,d=new Map,m=[],p=new Set,w=setInterval(()=>{B.cleanupRateLimit(),B.cleanupCsrfTokens();},120*1e3);async function b(i){let f=Date.now(),c=crypto.randomUUID(),C=new URL(i.url).pathname,v=i.method.toUpperCase(),y=me(i);p.add(c);try{let x=i.headers.get("content-length");if(x&&parseInt(x)>t)return a?.warn({requestId:c,size:x,ip:y},"Request too large"),new Response(JSON.stringify({error:"Payload too large"}),{status:413,headers:{"Content-Type":"application/json"}});let I=fe(i,s);if(v==="OPTIONS")return new Response(null,{status:204,headers:I});if(s.security&&typeof s.security=="object"&&s.security.rateLimit){let S=typeof s.security.rateLimit=="object"?s.security.rateLimit:{},A=S.max||100,M=S.windowMs||6e4,F=S.keyGenerator?S.keyGenerator({request:i,ip:y}):y;if(!B.checkRateLimit(F,A,M))return a?.warn({requestId:c,ip:y,key:F},"Rate limit exceeded"),new Response(JSON.stringify({error:S.message||"Too many requests"}),{status:429,headers:{"Content-Type":"application/json"}})}let V=null;["POST","PUT","PATCH"].includes(v)&&(V=await ge(i,a,t));let H=d.get("default"),j=q.match(v,C);if(!j){let S=X(y,i,{},H,a,c);return a?.warn({requestId:c,method:v,path:C,ip:y},"Route not found"),S.json({error:"Not Found",path:C},404)}let U=X(y,i,j.params||{},H,a,c);U.body=V,U.request=i;let Q=new AbortController,K=new Promise((S,A)=>{let M=setTimeout(()=>{Q.abort(),A(new P("Request timeout"));},n);Q.signal.addEventListener("abort",()=>clearTimeout(M));}),D=await Promise.race([j.handler(U),K]),$=new Headers(D.headers);I.forEach((S,A)=>{$.has(A)||$.set(A,S);}),$.set("X-Request-ID",c),$.set("X-Content-Type-Options","nosniff"),$.set("X-Frame-Options","DENY"),$.set("X-XSS-Protection","1; mode=block"),$.set("Referrer-Policy","strict-origin-when-cross-origin");let z=Date.now()-f;return B.logRequest(c,v,C,y,D.status,z),a?.info({requestId:c,method:v,path:C,status:D.status,duration:z,ip:y},"Request completed"),new Response(D.body,{status:D.status,headers:$})}catch(x){if(x instanceof E)return a?.warn({error:x.message,requestId:c,ip:y},`App error: ${x.message}`),new Response(JSON.stringify({error:x.message,code:x.code,requestId:c}),{status:x.statusCode,headers:{"Content-Type":"application/json"}});a?.error({error:String(x),requestId:c,ip:y},"Unhandled error");let I=process.env.NODE_ENV==="production"?"Internal Server Error":x.message;return new Response(JSON.stringify({error:I,requestId:c}),{status:500,headers:{"Content-Type":"application/json"}})}finally{p.delete(c);}}let l={method:"GET",path:"/health",handler:i=>i.json({status:"healthy",timestamp:new Date().toISOString(),uptime:process.uptime(),activeRequests:p.size})},g={method:"GET",path:"/readiness",handler:i=>{let f=d.size>0,c=f||d.size===0;return i.json({ready:c,checks:{database:f?"connected":"not configured",activeRequests:p.size},timestamp:new Date().toISOString()},c?200:503)}};s.routes&&s.routes.forEach(i=>{m.push(i),(Array.isArray(i.method)?i.method:[i.method]).forEach(c=>{q.register(c,i.path,i.handler,i);});}),m.push(l,g),q.register("GET","/health",l.handler,l),q.register("GET","/readiness",g.handler,g);let h=null,R={app:null,logger:a,db:d,bunServer:null,async start(){if(s.database){let f=Array.isArray(s.database)?s.database:[s.database];for(let c of f){let O=c.name||"default";try{if(typeof c.connection=="string"){let C=new L(c.connection);if(c.schema&&typeof c.schema=="object")for(let[v,y]of Object.entries(c.schema))y&&typeof y=="object"&&C.defineSchema(y);d.set(O,C),a?.info({name:O,connection:c.connection},"\u2714 Database connected");}else throw new Error(`Database connection must be a string path (got ${typeof c.connection})`)}catch(C){throw a?.error({error:String(C),name:O},"Failed to connect to database"),C}}}h=Bun.serve({port:e,hostname:r,fetch:b}),R.bunServer=h;let i=`http://${r}:${e}`;console.log(`\u2192 URL:          ${i}
\u2192 Environment:  ${process.env.NODE_ENV||"development"}
\u2192 Routes:       ${m.length.toString()}
\u2192 Database:     ${d.size>0?"\u2714 Connected":"\u274C None"}
\u2192 Security:     ${s.security?"\u2714 ENABLED":"\u274C Disabled"}

\u{1F50D} Health:    ${i}/health
\u{1F50D} Ready:     ${i}/readiness
`),a?.info({url:i},"Server started");},async stop(){if(a?.info("Stopping server..."),p.size>0){a?.info({count:p.size},"Waiting for active requests...");let i=Date.now()+o;for(;p.size>0&&Date.now()<i;)await new Promise(f=>setTimeout(f,100));p.size>0&&a?.warn({count:p.size},"Force closing with active requests");}if(clearInterval(w),s.onShutdown)try{await s.onShutdown();}catch(i){a?.error({error:String(i)},"Error in shutdown handler");}for(let[i,f]of d.entries())try{f&&typeof f.close=="function"&&f.close(),a?.info({name:i},"Database closed");}catch(c){a?.error({error:String(c),name:i},"Error closing database");}h&&(h.stop(),a?.info("Bun server stopped")),a?.info("Server stopped successfully");},addRoute(i){m.push(i),(Array.isArray(i.method)?i.method:[i.method]).forEach(c=>{q.register(c,i.path,i.handler,i);}),a?.info({method:i.method,path:i.path},"Route added");},addRoutes(i){i.forEach(f=>this.addRoute(f));},getRoutes(){return m}};return R}async function ge(s,e,r){let t=s.headers.get("content-type")||"";try{if(t.includes("application/json")){let n=await s.text();if(n.length>r)throw new T("Payload too large");if(!n.trim())return {};try{return JSON.parse(n)}catch(o){throw e?.warn({error:String(o),bodyPreview:n.substring(0,100)},"Invalid JSON in request body"),new T("Invalid JSON in request body")}}if(t.includes("application/x-www-form-urlencoded")){let n=await s.text();if(n.length>r)throw new T("Payload too large");return Object.fromEntries(new URLSearchParams(n))}if(t.includes("multipart/form-data"))return await s.formData()}catch(n){throw n instanceof T?n:(e?.error({error:String(n)},"Error parsing request body"),new T("Failed to parse request body"))}return {}}function he(s){let e=new Map;if(!s)return e;let r=s.split(";");for(let t of r){let[n,...o]=t.trim().split("=");if(n){let u=o.join("=");e.set(n,u?decodeURIComponent(u):"");}}return e}function X(s,e,r,t,n,o){let u=new URL(e.url),a=Object.fromEntries(u.searchParams),d=e.headers,m=200,p=new Map,w=he(d.get("cookie")||""),b={ip:s,request:e,params:r,query:a,headers:d,db:t,logger:n,requestId:o,get statusCode(){return m},set statusCode(l){m=l;},body:null,json(l,g){return new Response(JSON.stringify(l),{status:g??m,headers:{"Content-Type":"application/json",...this._setCookieHeaders()}})},text(l,g){return new Response(l,{status:g??m,headers:{"Content-Type":"text/plain",...this._setCookieHeaders()}})},html(l,g){return new Response(l,{status:g??m,headers:{"Content-Type":"text/html; charset=utf-8",...this._setCookieHeaders()}})},redirect(l,g=302){return new Response(null,{status:g,headers:{Location:l,...this._setCookieHeaders()}})},file(l,g="application/octet-stream"){let h=Bun.file(l);return new Response(h,{headers:{"Content-Type":g,...this._setCookieHeaders()}})},setCookie(l,g,h={}){let R=`${l}=${encodeURIComponent(g)}`;return h.maxAge!==void 0&&(R+=`; Max-Age=${h.maxAge}`),h.expires&&(R+=`; Expires=${h.expires.toUTCString()}`),h.path&&(R+=`; Path=${h.path}`),h.domain&&(R+=`; Domain=${h.domain}`),h.secure&&(R+="; Secure"),h.httpOnly&&(R+="; HttpOnly"),h.sameSite&&(R+=`; SameSite=${h.sameSite}`),p.set(l,R),b},getCookie(l){return w.get(l)},deleteCookie(l,g={}){return b.setCookie(l,"",{...g,maxAge:0,path:g.path||"/"})},setHeader(l,g){return d.set(l,g),b},getHeader(l){return d.get(l)||void 0},status(l){return m=l,b},_setCookieHeaders(){let l={};return p.size>0&&(l["Set-Cookie"]=Array.from(p.values())),l}};return b}function me(s){let e=s.headers.get("x-forwarded-for");if(e)return e.split(",").map(n=>n.trim())[0]||"unknown";let r=s.headers.get("x-real-ip");return r||"unknown"}function fe(s,e){let r=new Headers;if(!e.security||typeof e.security!="object"||!e.security.cors)return r;let t=typeof e.security.cors=="object"?e.security.cors:{},n=s.headers.get("Origin");if(n){typeof t.origin=="function"?t.origin(n)&&r.set("Access-Control-Allow-Origin",n):Array.isArray(t.origin)?t.origin.includes(n)&&r.set("Access-Control-Allow-Origin",n):typeof t.origin=="string"?r.set("Access-Control-Allow-Origin",t.origin):r.set("Access-Control-Allow-Origin",n);let o=t.methods||["GET","POST","PUT","DELETE","PATCH","OPTIONS"];r.set("Access-Control-Allow-Methods",o.join(", "));let u=t.allowedHeaders||["Content-Type","Authorization","X-Requested-With"];r.set("Access-Control-Allow-Headers",u.join(", ")),t.credentials&&r.set("Access-Control-Allow-Credentials","true"),t.maxAge&&r.set("Access-Control-Max-Age",t.maxAge.toString());}return r}var ve=pe;export{E as AppError,L as DB,W as DatabaseError,k as Logger,G as RateLimitError,_ as Router,N as SecurityManager,P as TimeoutError,T as ValidationError,ne as blob,Z as column,ve as default,ue as defaultValue,ee as integer,ie as notNull,se as numeric,oe as primaryKey,re as real,le as references,pe as server,Y as table,te as text,ae as unique};//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map