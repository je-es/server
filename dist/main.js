import*as le from'@je-es/sdb';export{DB,blob,column,defaultValue,index,integer,notNull,numeric,primaryKey,real,references,table,text,unique}from'@je-es/sdb';import me from'crypto';import {Logger}from'@je-es/slog';export{Logger}from'@je-es/slog';import {resolve,join,relative,extname}from'path';import {existsSync,statSync}from'fs';var X=class{constructor(){this.routes=new Map;this.regexRoutes=[];}match(e,t){let r=`${e}:${t}`;if(this.routes.has(r)){let n=this.routes.get(r);return {handler:n.handler,params:{},metadata:n.metadata}}for(let n of this.regexRoutes)if(n.method===e){let i=t.match(n.pattern);if(i){let u=i.groups||{};return {handler:n.handler,params:u,metadata:n.metadata}}}return null}getAll(){let e=Array.from(this.routes.entries()).map(([r,n])=>{let i=r.indexOf(":"),u=r.substring(0,i),a=r.substring(i+1);return {method:u,path:a,handler:n.handler}}),t=this.regexRoutes.map(r=>{let n=r.key.indexOf(":");return {method:r.method,path:r.key.substring(n+1),handler:r.handler}});return [...e,...t]}clear(){this.routes.clear(),this.regexRoutes=[];}remove(e,t){let r=`${e}:${t}`;if(this.routes.has(r))return this.routes.delete(r),true;let n=this.regexRoutes.findIndex(i=>i.key===r);return n>=0?(this.regexRoutes.splice(n,1),true):false}register(e,t,r,n={}){let i=`${e}:${t}`;if(t.includes(":")||t.includes("*")){let u=this.pathToRegex(t),a=this.regexRoutes.findIndex(v=>v.key===i),f={pattern:u,method:e,handler:r,key:i,metadata:n};a>=0?this.regexRoutes[a]=f:this.regexRoutes.push(f);}else this.routes.set(i,{handler:r,metadata:n});}pathToRegex(e){let t=e.replace(/[.+?^${}()|[\]\\]/g,"\\$&");return t=t.replace(/:(\w+)/g,"(?<$1>[^/]+)"),t=t.replace(/\*/g,".*"),new RegExp(`^${t}$`)}};var J=class{constructor(){this.rateLimitStore=new Map;this.csrfTokens=new Map;this.requestLog=new Map;this.MAX_REQUEST_LOG_SIZE=1e3;}checkRateLimit(e,t,r){let n=Date.now(),i=this.rateLimitStore.get(e);return i?n<i.reset?i.count>=t?false:(i.count++,true):(this.rateLimitStore.set(e,{count:1,reset:n+r}),true):(this.rateLimitStore.set(e,{count:1,reset:n+r}),true)}cleanupRateLimit(){let e=Date.now();for(let[t,r]of this.rateLimitStore.entries())e>r.reset&&this.rateLimitStore.delete(t);}generateCsrfToken(e,t=36e5){let r=me.randomBytes(32).toString("hex");return this.csrfTokens.set(r,{sessionId:e,expires:Date.now()+t}),r}validateCsrfToken(e,t){let r=this.csrfTokens.get(e);return r?Date.now()>r.expires?(this.csrfTokens.delete(e),false):r.sessionId===t?(this.csrfTokens.delete(e),true):false:false}cleanupCsrfTokens(){let e=Date.now();for(let[t,r]of this.csrfTokens.entries())e>r.expires&&this.csrfTokens.delete(t);}sanitizeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}sanitizeSql(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"").replace(/'/g,"''").replace(/"/g,'\\"').replace(/\u0000/g,""):""}logRequest(e,t,r,n,i,u){if(this.requestLog.set(e,{timestamp:new Date().toISOString(),method:t,path:r,ip:n,status:i,duration:u}),this.requestLog.size>this.MAX_REQUEST_LOG_SIZE){let{value:a}=this.requestLog.keys().next()||{value:null};a&&this.requestLog.delete(a);}}getRequestLog(e){return this.requestLog.get(e)}getAllRequestLogs(){return Array.from(this.requestLog.values())}clearAll(){this.rateLimitStore.clear(),this.csrfTokens.clear(),this.requestLog.clear();}getStats(){return {rateLimitEntries:this.rateLimitStore.size,csrfTokens:this.csrfTokens.size,requestLogs:this.requestLog.size}}};var P=class extends Error{constructor(t,r=500,n){super(t);this.message=t;this.statusCode=r;this.code=n;this.name="AppError";}},I=class extends P{constructor(t,r){super(t,400,"VALIDATION_ERROR");this.issues=r;this.name="ValidationError";}},ae=class extends P{constructor(e){super(e,500,"DATABASE_ERROR"),this.name="DatabaseError";}},W=class extends P{constructor(e="Request timeout"){super(e,408,"TIMEOUT_ERROR"),this.name="TimeoutError";}},ue=class extends P{constructor(e="Too many requests"){super(e,429,"RATE_LIMIT_ERROR"),this.name="RateLimitError";}};var O=class{constructor(e){this.fileCache=new Map;this.CACHE_MAX_SIZE=1e3;if(!existsSync(e.directory))throw new Error(`Static directory does not exist: ${e.directory}`);if(!statSync(e.directory).isDirectory())throw new Error(`Static path is not a directory: ${e.directory}`);this.resolvedDir=resolve(e.directory),this.config={path:e.path,directory:e.directory,maxAge:e.maxAge??3600,index:e.index??["index.html"],dotfiles:e.dotfiles??"deny",etag:e.etag??true,lastModified:e.lastModified??true,immutable:e.immutable??false,extensions:e.extensions??[],fallthrough:e.fallthrough??false,setHeaders:e.setHeaders};}handler(){return async e=>{let t=e.request.url,n=new URL(t).pathname;n.startsWith(this.config.path)&&(n=n.slice(this.config.path.length));try{n=decodeURIComponent(n);}catch{return e.json({error:"Invalid URL encoding"},400)}if(n.includes("..")||n.includes("\\"))return e.json({error:"Forbidden"},403);if(this.config.dotfiles!=="allow"&&n.split("/").some(a=>a.startsWith(".")))return this.config.dotfiles==="deny"?e.json({error:"Forbidden"},403):this.handleNotFound(e);let i=this.resolveFilePath(n);if(!i)return this.handleNotFound(e);if(!this.isPathSafe(i))return e.json({error:"Forbidden"},403);if(!existsSync(i))return this.handleNotFound(e);let u=statSync(i);return u.isDirectory()?this.serveDirectory(e,i,n):this.serveFile(e,i,u)}}getPathPattern(){return `${this.config.path}/*`}resolveFilePath(e){e.startsWith("/")&&(e=e.slice(1));let t=join(this.resolvedDir,e);if(!existsSync(t)&&this.config.extensions.length>0)for(let r of this.config.extensions){let n=`${t}.${r}`;if(existsSync(n))return n}return t}isPathSafe(e){return !relative(this.resolvedDir,resolve(e)).startsWith("..")&&!resolve(e).startsWith("..")}async serveDirectory(e,t,r){for(let n of this.config.index){let i=join(t,n);if(existsSync(i)){let u=statSync(i);if(u.isFile())return this.serveFile(e,i,u)}}return this.handleNotFound(e)}async serveFile(e,t,r){let n=e.request.method.toUpperCase();if(n!=="GET"&&n!=="HEAD")return e.json({error:"Method not allowed"},405);let i=t,u=this.fileCache.get(i);if(u&&u.mtime!==r.mtimeMs&&(u=void 0),!u){if(u={etag:this.generateEtag(r),lastModified:new Date(r.mtime),size:r.size,mtime:r.mtimeMs},this.fileCache.size>=this.CACHE_MAX_SIZE){let h=this.fileCache.keys().next().value;h&&this.fileCache.delete(h);}this.fileCache.set(i,u);}let a=e.request.headers.get("if-none-match"),f=e.request.headers.get("if-modified-since");if(this.config.etag&&a===u.etag)return new Response(null,{status:304,headers:this.buildHeaders(t,u)});if(this.config.lastModified&&f){let h=new Date(f);if(u.lastModified<=h)return new Response(null,{status:304,headers:this.buildHeaders(t,u)})}let v=Bun.file(t),L=this.buildHeaders(t,u);return this.config.setHeaders&&this.config.setHeaders(e,t),n==="HEAD"?new Response(null,{status:200,headers:L}):new Response(v,{status:200,headers:L})}buildHeaders(e,t){let r=new Headers,n=this.getMimeType(e);if(r.set("Content-Type",n),r.set("Content-Length",t.size.toString()),this.config.etag&&r.set("ETag",t.etag),this.config.lastModified&&r.set("Last-Modified",t.lastModified.toUTCString()),this.config.maxAge>0){let i=`public, max-age=${this.config.maxAge}`;this.config.immutable&&(i+=", immutable"),r.set("Cache-Control",i);}else r.set("Cache-Control","no-cache");return r.set("Accept-Ranges","bytes"),r}generateEtag(e){return `"${e.size.toString(16)}-${e.mtimeMs.toString(16)}"`}getMimeType(e){let t=extname(e).toLowerCase();return we[t]||"application/octet-stream"}handleNotFound(e){return this.config.fallthrough?e.json({error:"Not Found"},404):e.json({error:"Not Found"},404)}clearCache(){this.fileCache.clear();}getCacheStats(){return {entries:this.fileCache.size,maxSize:this.CACHE_MAX_SIZE}}};function xe(s){return new O(s)}var we={".html":"text/html; charset=utf-8",".htm":"text/html; charset=utf-8",".css":"text/css; charset=utf-8",".txt":"text/plain; charset=utf-8",".xml":"text/xml; charset=utf-8",".csv":"text/csv; charset=utf-8",".md":"text/markdown; charset=utf-8",".js":"application/javascript; charset=utf-8",".mjs":"application/javascript; charset=utf-8",".json":"application/json; charset=utf-8",".jsonld":"application/ld+json",".map":"application/json; charset=utf-8",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".svg":"image/svg+xml",".ico":"image/x-icon",".webp":"image/webp",".avif":"image/avif",".bmp":"image/bmp",".tiff":"image/tiff",".woff":"font/woff",".woff2":"font/woff2",".ttf":"font/ttf",".otf":"font/otf",".eot":"application/vnd.ms-fontobject",".mp3":"audio/mpeg",".wav":"audio/wav",".ogg":"audio/ogg",".m4a":"audio/mp4",".aac":"audio/aac",".flac":"audio/flac",".mp4":"video/mp4",".webm":"video/webm",".ogv":"video/ogg",".mov":"video/quicktime",".avi":"video/x-msvideo",".mkv":"video/x-matroska",".pdf":"application/pdf",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".zip":"application/zip",".rar":"application/x-rar-compressed",".7z":"application/x-7z-compressed",".tar":"application/x-tar",".gz":"application/gzip",".wasm":"application/wasm",".manifest":"text/cache-manifest",".webmanifest":"application/manifest+json"};var U=class{constructor(e){this.translations={};this.currentLanguage="en";this.defaultLanguage="en";this.supportedLanguages=new Set(["en"]);this.cachePath="";e&&(this.defaultLanguage=e.defaultLanguage||"en",this.currentLanguage=e.defaultLanguage||"en",this.cachePath=e.staticPath||"static/i18n",e.supportedLanguages&&(this.supportedLanguages=new Set(e.supportedLanguages)));}loadLanguage(e,t){this.translations[e]||(this.translations[e]={});let r=this.flattenObject(t);this.translations[e]={...this.translations[e],...r},this.supportedLanguages.add(e);}flattenObject(e,t=""){let r={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n],u=t?`${t}.${n}`:n;typeof i=="object"&&i!==null&&!Array.isArray(i)?Object.assign(r,this.flattenObject(i,u)):r[u]=String(i);}return r}loadTranslations(e){Object.entries(e).forEach(([t,r])=>{this.loadLanguage(t,r);});}setLanguage(e){this.supportedLanguages.has(e)?this.currentLanguage=e:this.supportedLanguages.has(this.defaultLanguage)&&(this.currentLanguage=this.defaultLanguage);}getLanguage(){return this.currentLanguage}getSupportedLanguages(){return Array.from(this.supportedLanguages)}t(e,t,r){let n=this.currentLanguage,i=this.getTranslation(e,r);return t&&Object.entries(t).forEach(([u,a])=>{let f=this.translations[n]?.[a]||this.translations[this.defaultLanguage]?.[a]||a;i=i.replace(new RegExp(`\\{${u}\\}`,"g"),f);}),i}getTranslation(e,t){let r=this.currentLanguage;return this.translations[r]?.[e]?this.translations[r]?.[e]||this.translations[this.defaultLanguage]?.[e]:(console.warn(`Translation key not found: ${e}`),t||e)}tLang(e,t,r){let n=this.currentLanguage;this.setLanguage(t);let i=this.t(e,r);return this.currentLanguage=n,i}getTranslations(){return this.translations[this.currentLanguage]||{}}hasKey(e){return !!(this.translations[this.currentLanguage]?.[e]||this.translations[this.defaultLanguage]?.[e])}},q=null;function re(s){return q||(q=new U(s)),q}function B(){return q||(q=new U),q}function Ce(s,e,t){return B().t(s,e,t)}function Se(s){B().setLanguage(s);}function ve(){return B().getLanguage()}function Le(){return B().getSupportedLanguages()}var K=new J,E=new X;function Ee(s={}){let e=Number(s.port)||3e3,t=s.hostname||"localhost",r=s.maxRequestSize||10*1024*1024,n=s.requestTimeout||3e4,i=s.gracefulShutdownTimeout||1e4,u=typeof s.logging=="object"?s.logging:{},a=s.logging?new Logger(u.level||"info",u.pretty):null,f=null;if(s.i18n){let o=typeof s.i18n=="object"?s.i18n:{};f=re({defaultLanguage:o.defaultLanguage||"en",supportedLanguages:o.supportedLanguages||["en","ar","fr"],staticPath:o.staticPath||"./src/frontend/static/i18n"});}let v=new Map,L=[],h=new Set,z=[],Z=setInterval(()=>{K.cleanupRateLimit(),K.cleanupCsrfTokens();},120*1e3);async function M(o,c){let p=Date.now(),d=crypto.randomUUID(),y=new URL(o.url).pathname,C=o.method.toUpperCase(),x=ke(o,c);h.add(d);try{let w=o.headers.get("content-length");if(w&&parseInt(w)>r)return a?.warn({requestId:d,size:w,ip:x},"Request too large"),new Response(JSON.stringify({error:"Payload too large"}),{status:413,headers:{"Content-Type":"application/json"}});let j=He(o,s);if(C==="OPTIONS")return new Response(null,{status:204,headers:j});if(s.security&&typeof s.security=="object"&&s.security.rateLimit){let k=typeof s.security.rateLimit=="object"?s.security.rateLimit:{},H=k.max||100,Y=k.windowMs||6e4,ie=k.keyGenerator?k.keyGenerator({request:o,ip:x}):x;if(!K.checkRateLimit(ie,H,Y))return a?.warn({requestId:d,ip:x,key:ie},"Rate limit exceeded"),new Response(JSON.stringify({error:k.message||"Too many requests"}),{status:429,headers:{"Content-Type":"application/json"}})}let b=null;["POST","PUT","PATCH"].includes(C)&&(b=await Te(o,a,r));let T=v.get("default"),A=Object.fromEntries(new URL(o.url).searchParams),ge=o.headers.get("cookie")||"",fe=pe(ge).get("lang"),$=A.lang||fe||o.headers.get("Accept-Language")?.split(",")[0]?.split("-")[0]||"en";f&&!f.getSupportedLanguages().includes($)&&($=f.getLanguage()),f&&f.setLanguage($);let F=E.match(C,y);if(!F){let k=de(x,o,{},T,a,d,f,$);if(a?.warn({requestId:d,method:C,path:y,ip:x},"Route not found"),s.onError)try{return await s.onError(404,y,C)}catch(H){a?.error({error:String(H),requestId:d},"Error in onError handler");}return k.json({error:"Not Found",path:y},404)}let V=de(x,o,F.params||{},T,a,d,f,$);V.body=b,V.request=o;let ne=new AbortController,he=new Promise((k,H)=>{let Y=setTimeout(()=>{ne.abort(),H(new W("Request timeout"));},n);ne.signal.addEventListener("abort",()=>clearTimeout(Y));}),se=F.metadata?.middlewares||[],Q;se.length>0?Q=l(V,se,F.handler):Q=Promise.resolve(F.handler(V));let N=await Promise.race([Q,he]),D=new Headers(N.headers);j.forEach((k,H)=>{D.has(H)||D.set(H,k);}),D.set("X-Request-ID",d),D.set("X-Content-Type-Options","nosniff"),D.set("X-Frame-Options","DENY"),D.set("X-XSS-Protection","1; mode=block"),D.set("Referrer-Policy","strict-origin-when-cross-origin");let oe=Date.now()-p;return K.logRequest(d,C,y,x,N.status,oe),a?.info({requestId:d,method:C,path:y,status:N.status,duration:oe,ip:x},"Request completed"),new Response(N.body,{status:N.status,headers:D})}catch(w){if(w instanceof P){if(a?.warn({error:w.message,requestId:d,ip:x},`App error: ${w.message}`),s.onError)try{return await s.onError(w.statusCode,y,C)}catch(b){a?.error({error:String(b),requestId:d},"Error in onError handler");}return new Response(JSON.stringify({error:w.message,code:w.code,requestId:d}),{status:w.statusCode,headers:{"Content-Type":"application/json"}})}a?.error({error:String(w),requestId:d,ip:x},"Unhandled error");let j=process.env.NODE_ENV==="production"?"Internal Server Error":w.message;if(s.onError)try{return await s.onError(500,y,C)}catch(b){a?.error({error:String(b),requestId:d},"Error in onError handler");}return new Response(JSON.stringify({error:j,requestId:d}),{status:500,headers:{"Content-Type":"application/json"}})}finally{h.delete(d);}}async function l(o,c,p){let d=0,g=null,y=o.json.bind(o),C=o.text.bind(o),x=o.html.bind(o),w=o.redirect.bind(o);o.json=function(b,T){let A=y(b,T);return g=A,A},o.text=function(b,T){let A=C(b,T);return g=A,A},o.html=function(b,T){let A=x(b,T);return g=A,A},o.redirect=function(b,T){let A=w(b,T);return g=A,A};async function j(){if(!g&&d<c.length){let b=c[d];d++,await b(o,j);}}return await j(),o.json=y,o.text=C,o.html=x,o.redirect=w,g||p(o)}let m={method:"GET",path:"/health",handler:o=>o.json({status:"healthy",timestamp:new Date().toISOString(),uptime:process.uptime(),activeRequests:h.size})},R={method:"GET",path:"/readiness",handler:o=>{let c=v.size>0,p=c||v.size===0;return o.json({ready:p,checks:{database:c?"connected":"not configured",activeRequests:h.size},timestamp:new Date().toISOString()},p?200:503)}};if(s.routes&&s.routes.forEach(o=>{L.push(o),(Array.isArray(o.method)?o.method:[o.method]).forEach(p=>{E.register(p,o.path,o.handler,o);});}),s.static){let o=Array.isArray(s.static)?s.static:[s.static];for(let c of o)try{let d=new O(c).handler(),g={method:"GET",path:c.path==="/"?"/*":`${c.path}/*`,handler:d};L.push(g);let y=c.path==="/"?"/":c.path;z.push({prefix:y,handler:d}),c.path==="/"?(E.register("GET","/",d,g),E.register("HEAD","/",d,g),E.register("GET","/*",d,g),E.register("HEAD","/*",d,g)):(E.register("GET",`${c.path}/*`,d,g),E.register("HEAD",`${c.path}/*`,d,g));}catch(p){throw a?.error({error:String(p),path:c.path},"Failed to initialize static file server"),p}}L.push(m,R),E.register("GET","/health",m.handler,m),E.register("GET","/readiness",R.handler,R);let S=null,G={app:null,logger:a,db:v,bunServer:null,async start(){if(f&&s.i18n){let c=typeof s.i18n=="object"?s.i18n:{},p=c.staticPath||"./src/frontend/static/i18n",d=c.supportedLanguages||["en","ar","fr"];try{for(let g of d){let y=`${p}/${g}.json`,C=Bun.file(y);if(await C.exists()){let x=await C.json();f.loadLanguage(g,x);}}a?.info({languages:f.getSupportedLanguages()},"i18n translations loaded");}catch(g){a?.warn({error:String(g)},"Failed to load i18n translations");}}if(s.database){let c=Array.isArray(s.database)?s.database:[s.database];for(let p of c){let d=p.name||"default";try{if(typeof p.connection=="string"){let g=new le.DB(p.connection);if(p.schema&&typeof p.schema=="object")for(let[,y]of Object.entries(p.schema))y&&typeof y=="object"&&g.defineSchema(y);v.set(d,g),a?.info({name:d,connection:p.connection},"\u2714 Database connected");}else throw new Error(`Database connection must be a string path (got ${typeof p.connection})`)}catch(g){throw a?.error({error:String(g),name:d},"Failed to connect to database"),g}}}S=Bun.serve({port:e,hostname:t,fetch:(c,p)=>M(c,p)}),G.bunServer=S;let o=`http://${t}:${e}`;if(a?.info({url:o},"\u2714 Server started"),s.onStartup)try{await s.onStartup(G);}catch(c){a?.error({error:String(c)},"Error in startup handler");}if(s.onReady)try{await s.onReady(G,v);}catch(c){a?.error({error:String(c)},"Error in ready handler");}},async stop(){if(a?.info("Stopping server..."),h.size>0){a?.info({count:h.size},"Waiting for active requests...");let o=Date.now()+i;for(;h.size>0&&Date.now()<o;)await new Promise(c=>setTimeout(c,100));h.size>0&&a?.warn({count:h.size},"Force closing with active requests");}if(clearInterval(Z),s.onShutdown)try{await s.onShutdown();}catch(o){a?.error({error:String(o)},"Error in shutdown handler");}for(let[o,c]of v.entries())try{c&&typeof c.close=="function"&&c.close(),a?.info({name:o},"Database closed");}catch(p){a?.error({error:String(p),name:o},"Error closing database");}S&&typeof S.stop=="function"&&(S.stop(),a?.info("Bun server stopped")),a?.info("Server stopped successfully");},addRoute(o){L.push(o),(Array.isArray(o.method)?o.method:[o.method]).forEach(p=>{E.register(p,o.path,o.handler,o);}),a?.info({method:o.method,path:o.path},"Route added");},addRoutes(o){o.forEach(c=>this.addRoute(c));},getRoutes(){return L}};return G}async function Te(s,e,t){let r=s.headers.get("content-type")||"";try{if(r.includes("application/json")){let n=await s.text();if(n.length>t)throw new I("Payload too large");if(!n.trim())return {};try{return JSON.parse(n)}catch(i){throw e?.warn({error:String(i),bodyPreview:n.substring(0,100)},"Invalid JSON in request body"),new I("Invalid JSON in request body")}}if(r.includes("application/x-www-form-urlencoded")){let n=await s.text();if(n.length>t)throw new I("Payload too large");return Object.fromEntries(new URLSearchParams(n))}if(r.includes("multipart/form-data"))return await s.formData()}catch(n){throw n instanceof I?n:(e?.error({error:String(n)},"Error parsing request body"),new I("Failed to parse request body"))}return {}}function pe(s){let e=new Map;if(!s)return e;let t=s.split(";");for(let r of t){let[n,...i]=r.trim().split("=");if(n){let u=i.join("=");e.set(n,u?decodeURIComponent(u):"");}}return e}function de(s,e,t,r,n,i,u=null,a="en"){let f=new URL(e.url),v=Object.fromEntries(f.searchParams),L=e.headers,h=200,z=new Map,Z=pe(L.get("cookie")||""),M={ip:s,request:e,params:t,query:v,headers:L,db:r,logger:n,i18n:u,lang:a,requestId:i,get statusCode(){return h},set statusCode(l){h=l;},body:null,state:{},json(l,m){return new Response(JSON.stringify(l),{status:m??h,headers:{"Content-Type":"application/json",...this._setCookieHeaders()}})},text(l,m){return new Response(l,{status:m??h,headers:{"Content-Type":"text/plain",...this._setCookieHeaders()}})},html(l,m){return new Response(l,{status:m??h,headers:{"Content-Type":"text/html; charset=utf-8",...this._setCookieHeaders()}})},redirect(l,m=302){return new Response(null,{status:m,headers:{Location:l,...this._setCookieHeaders()}})},file(l,m="application/octet-stream"){let R=Bun.file(l);return new Response(R,{headers:{"Content-Type":m,...this._setCookieHeaders()}})},setCookie(l,m,R={}){let S=`${l}=${encodeURIComponent(m)}`;return R.maxAge!==void 0&&(S+=`; Max-Age=${R.maxAge}`),R.expires&&(S+=`; Expires=${R.expires.toUTCString()}`),R.path&&(S+=`; Path=${R.path}`),R.domain&&(S+=`; Domain=${R.domain}`),R.secure&&(S+="; Secure"),R.httpOnly&&(S+="; HttpOnly"),R.sameSite&&(S+=`; SameSite=${R.sameSite}`),z.set(l,S),M},getCookie(l){return Z.get(l)},deleteCookie(l,m={}){return M.setCookie(l,"",{...m,maxAge:0,path:m.path||"/"})},setHeader(l,m){return L.set(l,m),M},getHeader(l){return L.get(l)||void 0},status(l){return h=l,M},_setCookieHeaders(){let l={};return z.size>0&&(l["Set-Cookie"]=Array.from(z.values())),l}};return M}function ke(s,e){let t=s.headers.get("x-forwarded-for");if(t)return t.split(",").map(i=>i.trim())[0]||"unknown";let r=s.headers.get("x-real-ip");if(r)return r;if(e)try{let i=e.requestIP?.(s);if(i?.address)return i.address}catch{}return "unknown"}function He(s,e){let t=new Headers;if(!e.security||typeof e.security!="object"||!e.security.cors)return t;let r=typeof e.security.cors=="object"?e.security.cors:{},n=s.headers.get("Origin");if(n){typeof r.origin=="function"?r.origin(n)&&t.set("Access-Control-Allow-Origin",n):Array.isArray(r.origin)?r.origin.includes(n)&&t.set("Access-Control-Allow-Origin",n):typeof r.origin=="string"?t.set("Access-Control-Allow-Origin",r.origin):t.set("Access-Control-Allow-Origin",n);let i=r.methods||["GET","POST","PUT","DELETE","PATCH","OPTIONS"];t.set("Access-Control-Allow-Methods",i.join(", "));let u=r.allowedHeaders||["Content-Type","Authorization","X-Requested-With"];t.set("Access-Control-Allow-Headers",u.join(", ")),r.credentials&&t.set("Access-Control-Allow-Credentials","true"),r.maxAge&&t.set("Access-Control-Max-Age",r.maxAge.toString());}return t}var Ve=Ee;
export{P as AppError,ae as DatabaseError,U as I18nManager,ue as RateLimitError,X as Router,J as SecurityManager,O as StaticFileServer,W as TimeoutError,I as ValidationError,xe as createStatic,Ve as default,ve as getCurrentLanguage,B as getI18n,Le as getSupportedLanguages,re as initI18n,Ee as server,Se as setLanguage,Ce as t};//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map